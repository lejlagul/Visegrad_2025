<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Hiro marker – 3‑D signalling network in a cell</title>

  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.js"></script>

  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{margin:0;overflow:hidden;font-family:monospace}
    #status{position:fixed;top:10px;left:10px;font-size:24px;color:#fff;
            z-index:1000;pointer-events:none}
    #loader{position:fixed;inset:0;display:flex;flex-direction:column;
            align-items:center;justify-content:center;background:#000}
    .spinner{width:48px;height:48px;border:6px solid #fff;
             border-top-color:transparent;border-radius:50%;
             animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>

<body>
  <div id="loader"><div class="spinner"></div><p style="color:#fff;margin-top:12px">Loading camera…</p></div>
  <div id="status">Searching…2025</div>

  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled:false;">
    <a-marker id="hiroMarker" preset="hiro" emitevents="true">
      <a-entity id="network" visible="false" drag-rotate>

        <!-- translucent “cell” wrapper -->
        <a-sphere radius="0.8"
                  color="#00ffff"
                  material="opacity:0.12; transparent:true; side:double"></a-sphere>

        <!-- 19 nodes (grey → red) -->
        <a-sphere id="sphere0" radius="0.12" position="0 0 0" color="#888"></a-sphere>

        <!-- inner hexagon (r ≈ 0.3 m) -->
        <a-sphere id="sphere1"  radius="0.12" position="0.30 0.00 0"  color="#888"></a-sphere>
        <a-sphere id="sphere2"  radius="0.12" position="0.15 0.26 0"  color="#888"></a-sphere>
        <a-sphere id="sphere3"  radius="0.12" position="-0.15 0.26 0" color="#888"></a-sphere>
        <a-sphere id="sphere4"  radius="0.12" position="-0.30 0.00 0" color="#888"></a-sphere>
        <a-sphere id="sphere5"  radius="0.12" position="-0.15 -0.26 0" color="#888"></a-sphere>
        <a-sphere id="sphere6"  radius="0.12" position="0.15 -0.26 0" color="#888"></a-sphere>

        <!-- top hexagon (r ≈ 0.5 m, z = 0.3 m) -->
        <a-sphere id="sphere7"  radius="0.12" position="0.50 0.00 0.30"  color="#888"></a-sphere>
        <a-sphere id="sphere8"  radius="0.12" position="0.25 0.43 0.30"  color="#888"></a-sphere>
        <a-sphere id="sphere9"  radius="0.12" position="-0.25 0.43 0.30" color="#888"></a-sphere>
        <a-sphere id="sphere10" radius="0.12" position="-0.50 0.00 0.30" color="#888"></a-sphere>
        <a-sphere id="sphere11" radius="0.12" position="-0.25 -0.43 0.30" color="#888"></a-sphere>
        <a-sphere id="sphere12" radius="0.12" position="0.25 -0.43 0.30"  color="#888"></a-sphere>

        <!-- bottom hexagon (r ≈ 0.5 m, z = ‑0.3 m) -->
        <a-sphere id="sphere13" radius="0.12" position="0.50 0.00 -0.30"  color="#888"></a-sphere>
        <a-sphere id="sphere14" radius="0.12" position="0.25 0.43 -0.30"  color="#888"></a-sphere>
        <a-sphere id="sphere15" radius="0.12" position="-0.25 0.43 -0.30" color="#888"></a-sphere>
        <a-sphere id="sphere16" radius="0.12" position="-0.50 0.00 -0.30" color="#888"></a-sphere>
        <a-sphere id="sphere17" radius="0.12" position="-0.25 -0.43 -0.30" color="#888"></a-sphere>
        <a-sphere id="sphere18" radius="0.12" position="0.25 -0.43 -0.30"  color="#888"></a-sphere>

        <!-- links: centre → every node -->
        <!-- (plus hexagon rims & radial struts for visual density) -->
        <!-- central spokes -->
        <a-entity line="start: 0 0 0; end: 0.30 0.00 0;    color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: 0.15 0.26 0;    color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: -0.15 0.26 0;   color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: -0.30 0.00 0;   color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: -0.15 -0.26 0;  color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: 0.15 -0.26 0;   color:#666"></a-entity>

        <!-- spokes to top ring -->
        <a-entity line="start: 0 0 0; end: 0.50 0.00 0.30;  color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: 0.25 0.43 0.30;  color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: -0.25 0.43 0.30; color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: -0.50 0.00 0.30; color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: -0.25 -0.43 0.30;color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: 0.25 -0.43 0.30; color:#666"></a-entity>

        <!-- spokes to bottom ring -->
        <a-entity line="start: 0 0 0; end: 0.50 0.00 -0.30;  color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: 0.25 0.43 -0.30;  color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: -0.25 0.43 -0.30; color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: -0.50 0.00 -0.30; color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: -0.25 -0.43 -0.30;color:#666"></a-entity>
        <a-entity line="start: 0 0 0; end: 0.25 -0.43 -0.30; color:#666"></a-entity>

        <!-- hexagon rims (inner, top, bottom) -->
        <!-- inner rim -->
        <a-entity line="start: 0.30 0.00 0; end: 0.15 0.26 0;    color:#666"></a-entity>
        <a-entity line="start: 0.15 0.26 0; end: -0.15 0.26 0;   color:#666"></a-entity>
        <a-entity line="start: -0.15 0.26 0; end: -0.30 0.00 0;  color:#666"></a-entity>
        <a-entity line="start: -0.30 0.00 0; end: -0.15 -0.26 0; color:#666"></a-entity>
        <a-entity line="start: -0.15 -0.26 0; end: 0.15 -0.26 0; color:#666"></a-entity>
        <a-entity line="start: 0.15 -0.26 0; end: 0.30 0.00 0;   color:#666"></a-entity>

        <!-- top rim -->
        <a-entity line="start: 0.50 0.00 0.30; end: 0.25 0.43 0.30;    color:#666"></a-entity>
        <a-entity line="start: 0.25 0.43 0.30; end: -0.25 0.43 0.30;   color:#666"></a-entity>
        <a-entity line="start: -0.25 0.43 0.30; end: -0.50 0.00 0.30;  color:#666"></a-entity>
        <a-entity line="start: -0.50 0.00 0.30; end: -0.25 -0.43 0.30; color:#666"></a-entity>
        <a-entity line="start: -0.25 -0.43 0.30; end: 0.25 -0.43 0.30; color:#666"></a-entity>
        <a-entity line="start: 0.25 -0.43 0.30; end: 0.50 0.00 0.30;   color:#666"></a-entity>

        <!-- bottom rim -->
        <a-entity line="start: 0.50 0.00 -0.30; end: 0.25 0.43 -0.30;    color:#666"></a-entity>
        <a-entity line="start: 0.25 0.43 -0.30; end: -0.25 0.43 -0.30;   color:#666"></a-entity>
        <a-entity line="start: -0.25 0.43 -0.30; end: -0.50 0.00 -0.30;  color:#666"></a-entity>
        <a-entity line="start: -0.50 0.00 -0.30; end: -0.25 -0.43 -0.30; color:#666"></a-entity>
        <a-entity line="start: -0.25 -0.43 -0.30; end: 0.25 -0.43 -0.30; color:#666"></a-entity>
        <a-entity line="start: 0.25 -0.43 -0.30; end: 0.50 0.00 -0.30;   color:#666"></a-entity>

        <!-- radial struts (inner → top & bottom rings) -->
        <a-entity line="start: 0.30 0.00 0;   end: 0.50 0.00 0.30;  color:#666"></a-entity>
        <a-entity line="start: 0.15 0.26 0;   end: 0.25 0.43 0.30;  color:#666"></a-entity>
        <a-entity line="start: -0.15 0.26 0;  end: -0.25 0.43 0.30; color:#666"></a-entity>
        <a-entity line="start: -0.30 0.00 0;  end: -0.50 0.00 0.30; color:#666"></a-entity>
        <a-entity line="start: -0.15 -0.26 0; end: -0.25 -0.43 0.30;color:#666"></a-entity>
        <a-entity line="start: 0.15 -0.26 0;  end: 0.25 -0.43 0.30; color:#666"></a-entity>

        <a-entity line="start: 0.30 0.00 0;   end: 0.50 0.00 -0.30;  color:#666"></a-entity>
        <a-entity line="start: 0.15 0.26 0;   end: 0.25 0.43 -0.30;  color:#666"></a-entity>
        <a-entity line="start: -0.15 0.26 0;  end: -0.25 0.43 -0.30; color:#666"></a-entity>
        <a-entity line="start: -0.30 0.00 0;  end: -0.50 0.00 -0.30; color:#666"></a-entity>
        <a-entity line="start: -0.15 -0.26 0; end: -0.25 -0.43 -0.30;color:#666"></a-entity>
        <a-entity line="start: 0.15 -0.26 0;  end: 0.25 -0.43 -0.30; color:#666"></a-entity>
      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <!-- drag‑rotate component -->
  <script>
    AFRAME.registerComponent('drag-rotate',{
      schema:{speed:{default:1}},
      init(){
        this.dragging=false;this.prevX=0;this.prevY=0;
        const cvs=this.el.sceneEl.canvas;
        const start=e=>{this.dragging=true;this.prevX=e.clientX;this.prevY=e.clientY};
        const move=(x,y,f=1)=>{if(!this.dragging)return;
          const r=this.el.getAttribute('rotation');
          this.el.setAttribute('rotation',{x:r.x+(y-this.prevY)*f*this.data.speed,
                                           y:r.y+(x-this.prevX)*f*this.data.speed,z:r.z});
          this.prevX=x;this.prevY=y;};
        cvs.addEventListener('mousedown',e=>start(e));
        window.addEventListener('mousemove',e=>move(e.clientX,e.clientY));
        window.addEventListener('mouseup',()=>this.dragging=false);
        cvs.addEventListener('touchstart',e=>start(e.touches[0]),{passive:false});
        window.addEventListener('touchmove',e=>{if(this.dragging){e.preventDefault();
          move(e.touches[0].clientX,e.touches[0].clientY,0.5);}},{passive:false});
        window.addEventListener('touchend',()=>this.dragging=false);
      }
    });

    /* signal‑propagation groups */
    const groups=[
      ["sphere0"],
      ["sphere1","sphere2","sphere3","sphere4","sphere5","sphere6"],
      ["sphere7","sphere8","sphere9","sphere10","sphere11","sphere12"],
      ["sphere13","sphere14","sphere15","sphere16","sphere17","sphere18"]
    ];
    let timers=[];
    function startPropagation(){
      groups.forEach((ids,i)=>{
        timers.push(setTimeout(()=>{
          ids.forEach(id=>document.getElementById(id).setAttribute('color','#ff0000'));
        },i*600));   // 600 ms between rings
      });
    }
    function resetPropagation(){
      timers.forEach(clearTimeout);timers=[];
      document.querySelectorAll('#network a-sphere')
        .forEach(s=>s.setAttribute('color','#888'));
    }

    /* marker logic */
    const scene=document.querySelector('a-scene');
    const marker=document.getElementById('hiroMarker');
    const net=document.getElementById('network');
    const status=document.getElementById('status');
    const loader=document.getElementById('loader');

    scene.addEventListener('loaded',()=>loader.style.display='none');
    marker.addEventListener('markerFound',()=>{
      net.setAttribute('visible',true);
      status.textContent='Success';
      startPropagation();
    });
    marker.addEventListener('markerLost',()=>{
      net.setAttribute('visible',false);
      status.textContent='Searching…2025';
      resetPropagation();
    });
  </script>
</body>
</html>
